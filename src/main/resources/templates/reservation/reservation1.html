<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
</head>
<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function(){
                    $("searchBtn").on("click",function(e){
                      //ê²€ìƒ‰ë²„íŠ¼ í´ë¦­ì‹œ form íƒœê·¸ ì „ì†¡ì„ ë§‰ìŠµë‹ˆë‹¤.
                        page(0);
                    });
                });

                function page(page){
                    var searchRoomType = $("#RoomType").val();
                    var searchCheckIn = $("#checkIns").val();
                    var searchCheckOut = $("#checkOuts").val();
                    var searchAdultCount = $("#adultCont").val();
                     var searchChildrenCount = $("#childCount").val();
                    var searchPrice = $("#pricess").val();

                    location.href="/user/reservations/" + page + "?searchRoomType=" + searchRoomType
                     + "&searchCheckIn=" + searchCheckIn  + "&searchCheckOut=" + searchCheckOut  + "&searchAdultCount=" + searchAdultCount
                      + "&searchChildrenCount=" + searchChildrenCount  + "&searchPrice=" + searchPrice;
                }

                function reservationCheck(){
                 var checkIn = $('#r_checkin').val();
                 var checkOut = $('#r_checkout').val();
                 var adult = $('#r_adults').val();

                    if (checkIn == "") {
                        alert("ì²´í¬ì¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
                        regForm.r_checkin.focus();
                        return false;
                    }
                    if (checkIn > checkOut) {
                        alert("ë‚ ì§œë¥¼ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”");
                        regForm.r_checkin.focus();
                        return false;
                    }

                    if (checkOut == "") {
                        alert("ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
                        regForm.r_checkout.focus();
                        return false;
                    }

                    if (adult < 1) {
                        alert("ì„±ì¸ ì¸ì›ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");
                        regForm.r_adults.focus();
                        return false;
                    }

                    if (checkOut <= checkIn) {
                        alert("ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”");
                        return false;
                    }
                    return true;
                }
    </script>
</th:block>
<!-- ì‚¬ìš©ì CSS ì¶”ê°€ -->
<th:block layout:fragment="css">
    <style>
        <style>
         #btn{
             margin-top:15px;
             margin-bottom:15px;
             background-color: #382f24;
             width:120px;
             height:50px;
             border: none;
             font-size:medium;
             color:#f1ebd5;
             }
        #r_checkin{
            width:100%;
        }
         #r_checkout{
            width:100%;
        }
    </style>
    </style>
</th:block>

<div layout:fragment="content" style="margin: 0 auto; width: 50%;">
    <h2>ê°ì‹¤ ì˜ˆì•½</h2>

    <!-- ğŸ” ê²€ìƒ‰ ì¡°ê±´ ì…ë ¥ -->
    <form name="regForm" th:action="@{'/user/reservations/' + ${rooms != null ? rooms.number : 0}}" method="get" th:object="${reservationDto}">
        <table class="reserve1" style="width: 100%; text-align: center;">
            <thead>
            <tr style="color: #a0a0a0; font-weight: bold;">
                <th>ì²´í¬ì¸</th>
                <th>ì²´í¬ì•„ì›ƒ</th>
                <th>ì„±ì¸</th>
                <th>ì–´ë¦°ì´</th>
                <th>ë°© ì¢…ë¥˜</th>
                <th>ê°€ê²©</th>
                <th>ê²€ìƒ‰</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><input type="date" th:field="*{searchCheckIn}" required /></td>
                <td><input type="date" th:field="*{searchCheckOut}" required /></td>
                <td><input type="number" min="1" th:field="*{searchAdultCount}" required /></td>
                <td><input type="number" min="0" th:field="*{searchChildrenCount}" required /></td>
                <td>
                    <select th:field="*{searchRoomType}">
                        <option value="STANDARD">ìŠ¤íƒ ë‹¤ë“œë£¸</option>
                        <option value="DELUXE">ë””ëŸ­ìŠ¤ë£¸</option>
                        <option value="ROYAL">ë¡œì–„ë£¸</option>
                        <option value="SWEET">ìŠ¤ìœ„íŠ¸ë£¸</option>
                    </select>
                </td>
                <td>
                    <select th:field="*{searchPrice}">
                        <option value="10000">10000</option>
                        <option value="20000">20000</option>
                        <option value="30000">30000</option>
                        <option value="40000">40000</option>
                    </select>
                </td>
                <td><button type="submit">ê²€ìƒ‰</button></td>
            </tr>
            </tbody>
        </table>
    </form>

    <!-- ğŸ’¡ ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆëŠ” ê²½ìš° -->
    <div th:if="${reservationDto.searchCheckIn != null and reservationDto.searchCheckOut != null and reservationDto.searchAdultCount != null and reservationDto.searchChildrenCount != null and rooms != null and rooms.totalElements > 0}" style="margin-top: 2rem;">
        <div th:each="room : ${rooms.content}" style="border: 1px solid #ccc; padding: 1rem; margin-bottom: 1rem;">
            <img th:src="${room.imgUrl}" width="300" height="250" alt="ê°ì‹¤ ì´ë¯¸ì§€" />
            <h3>[[${room.type}]]</h3>
            <p>ê°ì‹¤ í¬ê¸°: [[${room.size}]]ã¡</p>
            <p>ìµœëŒ€ ì¸ì›: [[${room.totalCount}]]ëª…</p>

            <!-- ìƒíƒœ í‘œì‹œ ì¡°ê±´ë¬¸ -->
            <p>
                ìƒíƒœ:
                <span th:if="${room.stockNumber > 0}" style="color: green;">ì˜ˆì•½ ê°€ëŠ¥</span>
                <span th:unless="${room.stockNumber > 0}" style="color: red;">ì˜ˆì•½ ë§ˆê°</span>
            </p>

            <!-- ì˜ˆì•½ í¼ -->
            <form method="get" th:action="@{'/user/reservation2/' + ${room.id}}" th:object="${reservationDto}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <input type="hidden" th:field="*{searchCheckIn}" />
            <input type="hidden" th:field="*{searchCheckOut}" />
            <input type="hidden" th:field="*{searchAdultCount}" />
            <input type="hidden" th:field="*{searchChildrenCount}" />
            <input type="hidden" th:field="*{searchRoomType}" />
            <input type="hidden" th:field="*{searchPrice}" />

            <p>[[${room.price}]]ì› / 1ë°•</p>
            <button type="submit" th:disabled="${room.stockNumber <= 0}">ì˜ˆì•½í•˜ê¸°</button>
            </form>
        </div>
    </div>

    <!-- âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš° -->
    <div th:if="${reservationDto.searchCheckIn != null and reservationDto.searchCheckOut != null and reservationDto.searchAdultCount != null and reservationDto.searchChildrenCount != null and rooms != null and rooms.totalElements == 0}" style="margin-top: 2rem;">
        <p style="text-align: center; color: gray;">ì¡°ê±´ì— ë§ëŠ” ê°ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div th:if="${rooms != null and rooms.totalPages > 1}" class="pagination justify-content-center" style="margin-top: 2rem;">
        <ul class="pagination">
            <li class="page-item" th:classappend="${rooms.first} ? 'disabled'">
                <a class="page-link" th:href="@{'/user/reservations/' + ${rooms.number - 1}}">ì´ì „</a>
            </li>
            <li class="page-item" th:each="page : ${#numbers.sequence(1, rooms.totalPages)}"
                th:classappend="${rooms.number == page - 1} ? 'active'">
                <a class="page-link" th:href="@{'/user/reservations/' + ${page - 1}}">[[${page}]]</a>
            </li>
            <li class="page-item" th:classappend="${rooms.last} ? 'disabled'">
                <a class="page-link" th:href="@{'/user/reservations/' + ${rooms.number + 1}}">ë‹¤ìŒ</a>
            </li>
        </ul>
    </div>
</div>


</html>